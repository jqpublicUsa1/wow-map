<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Criminals Democrats are Protcting DHS Worst of the Worst</title>
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
  h1{margin:0;padding:10px;background:#111;color:#fff;text-align:center}
  .map{max-width:1200px;margin:12px auto;background:#fff;padding:10px;border-radius:8px}
  svg{width:100%;height:auto;display:block}
  .state{stroke:#fff;stroke-width:1;cursor:pointer}
  .state:hover{filter:brightness(1.08)}
  .note{text-align:center;color:#555;font-size:16px;margin:10px 0 18px}
</style>
</head>
<body>
<h1>Criminals Democrats are Protcting DHS Worst of the Worst</h1>
<div class="map" id="map"></div>
<div class="note">Tap a state to open the official DHS WoW page filtered by that state (opens a new tab).</div>

<script>
/* ====== Static 2024 coloring (edit if you want different) ====== */
const RED = new Set([
  "AL","AK","AR","FL","ID","IN","IA","KS","KY","LA","MO","MS","MT","ND",
  "NE","OH","OK","SC","SD","TN","TX","UT","WV","WY"
]);

const BLUE = new Set([
  "AZ","CA","CO","CT","DE","GA","HI","IL","ME","MD","MA","MI","MN","NV",
  "NH","NJ","NM","NY","NC","OR","PA","RI","VT","VA","WA","WI","DC"
]);

/* ====== Canonical names ====== */
const CODE_TO_NAME = {
  AL:"Alabama", AK:"Alaska", AZ:"Arizona", AR:"Arkansas", CA:"California",
  CO:"Colorado", CT:"Connecticut", DE:"Delaware", FL:"Florida", GA:"Georgia",
  HI:"Hawaii", ID:"Idaho", IL:"Illinois", IN:"Indiana", IA:"Iowa",
  KS:"Kansas", KY:"Kentucky", LA:"Louisiana", ME:"Maine", MD:"Maryland",
  MA:"Massachusetts", MI:"Michigan", MN:"Minnesota", MS:"Mississippi", MO:"Missouri",
  MT:"Montana", NE:"Nebraska", NV:"Nevada", NH:"New Hampshire", NJ:"New Jersey",
  NM:"New Mexico", NY:"New York", NC:"North Carolina", ND:"North Dakota", OH:"Ohio",
  OK:"Oklahoma", OR:"Oregon", PA:"Pennsylvania", RI:"Rhode Island", SC:"South Carolina",
  SD:"South Dakota", TN:"Tennessee", TX:"Texas", UT:"Utah", VT:"Vermont",
  VA:"Virginia", WA:"Washington", WV:"West Virginia", WI:"Wisconsin", WY:"Wyoming",
  DC:"District of Columbia"
};

const NAME_TO_CODE = Object.fromEntries(
  Object.entries(CODE_TO_NAME).map(([k,v]) => [v.toLowerCase(), k])
);

const DHS_BASE =
  "https://www.dhs.gov/wow?combine=&field_country_of_origin_target_id=All&field_state_value=";

function colorFor(code){
  if (RED.has(code)) return "#b22234";     // Republican red
  if (BLUE.has(code)) return "#3c3b6e";    // Democrat blue
  return "#d0d0d0";                        // neutral gray
}

/* Normalize SimpleMaps IDs like:
   "Texas", "TEXAS", "Texas_State", "new-york", "DistrictOfColumbia", "DC"
*/
function normalizeIdToName(raw){
  if(!raw) return "";
  let s = raw.trim();

  // Convert camelCase -> spaces: DistrictOfColumbia -> District Of Columbia
  s = s.replace(/([a-z])([A-Z])/g, "$1 $2");

  // Replace separators with spaces
  s = s.replace(/[_\-]+/g, " ");

  // Collapse spaces
  s = s.replace(/\s+/g, " ").trim();

  return s;
}

function resolveState(rawId){
  const id = (rawId || "").trim();
  const up = id.toUpperCase();

  // 1) If already a 2-letter code
  if (CODE_TO_NAME[up]) {
    return { code: up, name: CODE_TO_NAME[up] };
  }

  // 2) Normalize to a name
  const normName = normalizeIdToName(id);

  // 3) Try direct lowercase match
  const code = NAME_TO_CODE[normName.toLowerCase()];
  if (code) return { code, name: CODE_TO_NAME[code] };

  // 4) Some SimpleMaps files use abbreviations like "D.C." or "Washington DC"
  const alt = normName.toLowerCase()
    .replace(/\./g,"")
    .replace("washington dc","district of columbia")
    .replace("dc","district of columbia");

  const code2 = NAME_TO_CODE[alt];
  if (code2) return { code: code2, name: CODE_TO_NAME[code2] };

  return null;
}

fetch("./us-states.svg", { cache: "no-store" })
  .then(r => r.text())
  .then(svgText => {
    document.getElementById("map").innerHTML = svgText;

    const svg = document.querySelector("#map svg");
    if(!svg){
      document.getElementById("map").innerHTML =
        "<p style='padding:12px;color:#b00'>SVG did not load. Confirm <b>us-states.svg</b> is in the repo root.</p>";
      return;
    }

    // Grab any shapes with an id (SimpleMaps uses paths/polygons/groups)
    const elems = svg.querySelectorAll("[id]");

    let wired = 0;

    elems.forEach(el => {
      const st = resolveState(el.id);
      if (!st) return;

      // Color
      el.classList.add("state");
      el.style.fill = colorFor(st.code);

      // Click => DHS (uses full name)
      el.addEventListener("click", (e) => {
        e.preventDefault();
        window.open(DHS_BASE + encodeURIComponent(st.name), "_blank", "noopener");
      });

      wired++;
    });

    // If nothing got wired, the SVG IDs are unusual—still fixable.
    if (wired < 20) {
      console.log("Not enough states detected. Sample IDs:", Array.from(elems).slice(0,20).map(x=>x.id));
      document.querySelector(".note").textContent =
        "Map loaded, but state IDs didn’t match expected patterns. Tell me one ID you see in the SVG and I’ll adjust instantly.";
    }
  })
  .catch(() => {
    document.getElementById("map").innerHTML =
      "<p style='padding:12px;color:#b00'>Could not load <b>us-states.svg</b>. Make sure it is uploaded to the repo root.</p>";
  });
</script>
</body>
</html>
